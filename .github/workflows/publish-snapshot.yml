name: Publish Snapshot

# Automatically publish snapshot versions to Maven Central Snapshots repository
# whenever code is pushed to the master branch
on:
  push:
    branches: [ master ]

jobs:
  publish-snapshot:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Gradle wrapper validation
      uses: gradle/actions/wrapper-validation@v3

    # JDK 17 is required for:
    # 1. Building TestNG (jdkBuildVersion=17 in build-parameters)
    # 2. Running the nmcp plugin (requires Java 17+)
    # Note: TestNG artifacts still target Java 11 (targetJavaVersion=11)
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: 17

    - name: Publish Snapshot to Central
      env:
        CENTRAL_PORTAL_USERNAME: ${{ secrets.NEXUS_USERNAME }}
        CENTRAL_PORTAL_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}
      run: |
        ./gradlew publishAllPublicationsToCentralSnapshotsRepository \
          -Prelease=false \
          --no-daemon \
          --stacktrace

    - name: Display completion message
      run: |
        echo "âœ… Snapshot published to Maven Central Snapshots repository"
        echo "Snapshots are available at: https://central.sonatype.com/artifact/org.testng/testng"
